<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escrever | StoryWorld</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ✅ NAVBAR -->
<nav class="navbar">
  <a href="index.html" class="logo">StoryWorld</a>

  <ul class="nav-links">
    <li><a href="catalog.html">Catálogo</a></li>
    <li><a class="active" href="writer.html">Escrever</a></li>
    <li><a href="search.html">Buscar</a></li>
  </ul>

  <div id="nav-account"></div>
</nav>

<!-- ✅ Conteúdo principal -->
<main class="write-container">
  <h2>Escrever nova História</h2>

  <form id="storyForm" class="write-box">
    
    <label for="title">Título da história</label>
    <input type="text" id="title" placeholder="Ex: A Lenda de Arion" required>

    <label for="topic">Gênero / Categoria</label>
    <input type="text" id="topic" placeholder="Ex: Romance, Fantasia, Aventura">

    <label for="coverUrl">Capa (URL da imagem)</label>
    <input type="text" id="coverUrl" placeholder="https://exemplo.com/minha-capa.jpg">

    <h3>Capítulos</h3>
    <div id="chapters">
      <textarea class="chapter-text" placeholder="Escreva o capítulo 1..." rows="6"></textarea>
    </div>

    <button type="button" class="secondary-btn" onclick="addChapter()">+ Adicionar capítulo</button>
    <button type="submit" class="primary-btn">Salvar História</button>
  </form>
</main>

<script>
// ✅ Verifica login antes de permitir acessar
const currentUser = JSON.parse(localStorage.getItem("sw_user"));
if (!currentUser) {
  alert("Você precisa estar logado para escrever histórias.");
  window.location.href = "login.html";
}

// ✅ Adicionar novo capítulo
function addChapter() {
  const chaptersDiv = document.getElementById('chapters');
  const chapterCount = chaptersDiv.querySelectorAll('textarea').length + 1;

  const newChapter = document.createElement('textarea');
  newChapter.placeholder = `Escreva o capítulo ${chapterCount}...`;
  newChapter.rows = 6;
  newChapter.classList.add("chapter-text");

  chaptersDiv.appendChild(newChapter);
}

// ✅ Salvar história no LocalStorage
document.getElementById('storyForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const title = document.getElementById('title').value.trim();
  const topic = document.getElementById('topic').value.trim();
  const coverUrl = document.getElementById('coverUrl').value.trim();
  const chapters = Array.from(document.querySelectorAll('.chapter-text')).map(c => c.value.trim());

  if (!title) {
    alert("O título é obrigatório!");
    return;
  }

  // Montar objeto de história
  const newStory = {
    title,
    topic,
    coverUrl,
    chapters,
    author: currentUser.username,
    date: new Date().toLocaleDateString("pt-BR")
  };

  let stories = JSON.parse(localStorage.getItem("stories") || "[]");
  stories.push(newStory);
  localStorage.setItem("stories", JSON.stringify(stories));

  alert("História salva com sucesso!");
  window.location.href = "catalog.html";
});
</script>

<script src="auth.js"></script>
</body>
</html>
