<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Perfil | StoryWorld</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
  <a href="index.html" class="logo">StoryWorld</a>
  <ul class="nav-links">
    <li><a href="catalog.html">CatÃ¡logo</a></li>
    <li><a href="writer.html">Escrever</a></li>
    <li><a href="search.html">Buscar</a></li>
  </ul>
  <div id="nav-account"></div>
</nav>

<!-- LAYOUT COM MENU -->
<div class="profile-layout">

  <!-- MENU LATERAL -->
  <aside class="profile-sidebar">
    <div class="sidebar-header">
      <img id="nav-profile-pic" src="https://via.placeholder.com/80" alt="Foto">
      <h3 id="nav-username">UsuÃ¡rio</h3>
    </div>
    <ul>
      <li><a href="perfil.html" class="active">ğŸ‘¤ Meu Perfil</a></li>
      <li><a href="#">ğŸ“š Minhas HistÃ³rias</a></li>
      <li><a href="#">â¤ï¸ Favoritos</a></li>
      <li><a href="#">âš™ï¸ ConfiguraÃ§Ãµes</a></li>
      <li><a href="#" onclick="logoutUser()">ğŸšª Sair</a></li>
    </ul>
  </aside>

  <!-- CONTEÃšDO DO PERFIL -->
  <main class="profile-content">

    <!-- CAPA DO PERFIL -->
    <div class="profile-banner">
      <img id="banner-img" src="https://via.placeholder.com/1000x300" alt="Capa do perfil">
      <input type="file" id="banner-upload" accept="image/*">
    </div>

    <!-- FOTO DE PERFIL E INFOS -->
    <div class="profile-info">
      <img id="profile-img" class="avatar" src="https://via.placeholder.com/120" alt="Foto de perfil">
      <input type="file" id="avatar-upload" accept="image/*" hidden>

      <h2 id="profile-name">Nome do UsuÃ¡rio</h2>
      <p id="profile-email"></p>
    </div>

    <!-- EDITAR BIO -->
    <div class="profile-edit">
      <label>Nome de usuÃ¡rio</label>
      <input type="text" id="username">

      <label>DescriÃ§Ã£o</label>
      <textarea id="bio" rows="4" placeholder="Fale um pouco sobre vocÃª..."></textarea>

      <button class="save-btn" onclick="saveProfile()">ğŸ’¾ Salvar alteraÃ§Ãµes</button>
    </div>

  </main>
</div>

<script src="auth.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const user = JSON.parse(localStorage.getItem("sw_user"));
    if (!user) {
        window.location.href = "login.html";
        return;
    }

    // Preenche os dados
    document.getElementById("nav-profile-pic").src = user.photo || "https://via.placeholder.com/80";
    document.getElementById("profile-img").src = user.photo || "https://via.placeholder.com/120";
    document.getElementById("nav-username").textContent = user.username || "UsuÃ¡rio";
    document.getElementById("profile-name").textContent = user.username;
    document.getElementById("profile-email").textContent = user.email;
    document.getElementById("username").value = user.username;
    document.getElementById("bio").value = user.bio || "";
    if (user.banner) document.getElementById("banner-img").src = user.banner;
});

// Salvar perfil
function saveProfile() {
    let user = JSON.parse(localStorage.getItem("sw_user"));
    user.username = document.getElementById("username").value;
    user.bio = document.getElementById("bio").value;
    localStorage.setItem("sw_user", JSON.stringify(user));
    alert("âœ… Perfil atualizado!");
    location.reload();
}

// Troca de avatar
document.getElementById("profile-img").addEventListener("click", () => {
  document.getElementById("avatar-upload").click();
});
document.getElementById("avatar-upload").addEventListener("change", function (e) {
  const reader = new FileReader();
  reader.onload = function () {
    let user = JSON.parse(localStorage.getItem("sw_user"));
    user.photo = reader.result;
    localStorage.setItem("sw_user", JSON.stringify(user));
    location.reload();
  };
  reader.readAsDataURL(e.target.files[0]);
});

// Troca de banner
document.getElementById("banner-img").addEventListener("click", () => {
  document.getElementById("banner-upload").click();
});
document.getElementById("banner-upload").addEventListener("change", function (e) {
  const reader = new FileReader();
  reader.onload = function () {
    let user = JSON.parse(localStorage.getItem("sw_user"));
    user.banner = reader.result;
    localStorage.setItem("sw_user", JSON.stringify(user));
    location.reload();
  };
  reader.readAsDataURL(e.target.files[0]);
});

function logoutUser() {
    localStorage.removeItem("sw_user");
    window.location.href = "index.html";
}
</script>

</body>
</html>
